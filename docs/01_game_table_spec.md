# ゲームテーブル仕様

## 目的

外部シミュレーションやゲーム実装が出力する結果を、標準化されたテーブル形式で受け取り、
後段の貢献度指標計算に利用します。

## 標準カラム

最低限、以下のカラムを想定します。

- `scenario_id`: シナリオ識別子（任意の文字列または整数）
- `game_id`: ゲームインスタンスの識別子
- `coalition`: 連立（プレイヤー集合）
- `value`: 連立の値（TU ゲームなど）
- `rank`: 連立の順位（ordinal ゲームなど）
- `parameters`: 任意の追加パラメータ（JSON 文字列など、オプション）

`value` は必須、`rank` は省略可能です。  
`rank` が存在しない場合は、CLI 実行時に `value` から自動生成します。

### 数値値から順位への変換（coalition レベル）

TU ゲームなどで `value` だけが与えられている場合でも、
内部ユーティリティ `contrib_metrics.model.transforms.add_rank_from_value` と
設定ファイルの `input.ranking` セクションを用いることで、同一テーブル内に ordinal 用の
`rank` カラムを自動生成します。

- グルーピング単位: `(scenario_id, game_id)`
- ランキング対象: 各グループ内の `value`
- デフォルトでは「大きい値ほど良い」とみなし、
  値が大きいほど小さい順位（1 が最良）を割り当てます（dense ranking）。
- オプションとして、`value` を一定幅でビン分割してから順位付けする
  「階級づけ」もサポートします（例: `bin_width = 0.01`）。

## coalition 表現

入力段階では複数の表現を許容しますが、内部では `frozenset[int]` に正規化します。

- bitmask: 整数値（例: `13` → `{0, 2, 3}`）
- string:
  - カンマ区切り ID リスト（例: "1,3,5" → `{1, 3, 5}`）
  - ビット列文字列（例: "1101" → `{0, 2, 3}`）
- list: JSON 形式のリスト（例: `[1,3,5]`）

正規化ロジックは `contrib_metrics.utils.coalition_encoding` を参照してください。
